---
version: 2
macros:
  - name: get_fiscal_year
    description: >
      A macro that allows you to get fiscal year from a date, datetime,
      or timestamp with a fiscal year start date. Usage shown below
      SELECT date_timestamp,
        channel,
        best_guess_entity,
        "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_year,
        "{{dbt_arc_functions.get_fiscal_quarter('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_quarter,
        "{{dbt_arc_functions.get_fiscal_month('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_month,
        "{{dbt_arc_functions.get_fiscal_week('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_week,
        "{{dbt_arc_functions.get_fiscal_day('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_day,
        total_gifts,
        SUM(total_gifts)OVER(PARTITION BY channel, best_guess_entity, "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      ORDER BY date_timestamp) AS total_gifts_cumulative_fiscal_year,
        total_revenue,
        SUM(total_revenue)OVER(PARTITION BY channel, best_guess_entity, "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      ORDER BY date_timestamp) AS total_revenue_cumulative_fiscal_year,
      FROM "{{ ref('YOUR_MODEL_HERE') }}"
      WHERE total_gifts > 0 OR total_revenue > 0
      ORDER BY 2,3,1 ASC
    docs:
      show: true
    arguments:
      - name: date_to_convert
        type: date, datetime, or timestamp
        description: A date you'd like to get the fiscal year out of.
      - name: fiscal_year_start
        type: string
        description: Fiscal year start date in MM-YY format. How to use can be seen
          in the snippet below
  - name: get_fiscal_quarter
    description: >
      A macro that allows you to get fiscal quarter from a date, datetime,
      or timestamp with a fiscal year start date. Usage shown below
      SELECT date_timestamp,
        channel,
        best_guess_entity,
        "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_year,
        "{{dbt_arc_functions.get_fiscal_quarter('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_quarter,
        "{{dbt_arc_functions.get_fiscal_month('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_month,
        "{{dbt_arc_functions.get_fiscal_week('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_week,
        "{{dbt_arc_functions.get_fiscal_day('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_day,
        total_gifts,
        SUM(total_gifts)OVER(PARTITION BY channel, best_guess_entity, "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      ORDER BY date_timestamp) AS total_gifts_cumulative_fiscal_year,
        total_revenue,
        SUM(total_revenue)OVER(PARTITION BY channel, best_guess_entity, "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      ORDER BY date_timestamp) AS total_revenue_cumulative_fiscal_year,
      FROM "{{ ref('YOUR_MODEL_HERE') }}"
      WHERE total_gifts > 0 OR total_revenue > 0
      ORDER BY 2,3,1 ASC
    docs:
      show: true
    arguments:
      - name: date_to_convert
        type: date, datetime, or timestamp
        description: A date you'd like to get the fiscal quarter out of.
      - name: fiscal_year_start
        type: string
        description: Fiscal year start date in MM-YY format.
  - name: get_fiscal_month
    description: >
      A macro that allows you to get fiscal month from a date, datetime,
      or timestamp with a fiscal year start date.Usage shown below
      SELECT date_timestamp,
        channel,
        best_guess_entity,
        "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_year,
        "{{dbt_arc_functions.get_fiscal_quarter('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_quarter,
        "{{dbt_arc_functions.get_fiscal_month('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_month,
        "{{dbt_arc_functions.get_fiscal_week('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_week,
        "{{dbt_arc_functions.get_fiscal_day('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_day,
        total_gifts,
        SUM(total_gifts)OVER(PARTITION BY channel, best_guess_entity, "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      ORDER BY date_timestamp) AS total_gifts_cumulative_fiscal_year,
        total_revenue,
        SUM(total_revenue)OVER(PARTITION BY channel, best_guess_entity, "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      ORDER BY date_timestamp) AS total_revenue_cumulative_fiscal_year,
      FROM "{{ ref('YOUR_MODEL_HERE') }}"
      WHERE total_gifts > 0 OR total_revenue > 0
      ORDER BY 2,3,1 ASC
    docs:
      show: true
    arguments:
      - name: date_to_convert
        type: date, datetime, or timestamp
        description: A date you'd like to get the fiscal month out of.
      - name: fiscal_year_start
        type: string
        description: Fiscal year start date in MM-YY format.
  - name: get_fiscal_week
    description: >
      A macro that allows you to get fiscal week from a date, datetime,
      or timestamp with a fiscal year start date. Usage shown below
      SELECT date_timestamp,
        channel,
        best_guess_entity,
        "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_year,
        "{{dbt_arc_functions.get_fiscal_quarter('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_quarter,
        "{{dbt_arc_functions.get_fiscal_month('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_month,
        "{{dbt_arc_functions.get_fiscal_week('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_week,
        "{{dbt_arc_functions.get_fiscal_day('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_day,
        total_gifts,
        SUM(total_gifts)OVER(PARTITION BY channel, best_guess_entity, "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      ORDER BY date_timestamp) AS total_gifts_cumulative_fiscal_year,
        total_revenue,
        SUM(total_revenue)OVER(PARTITION BY channel, best_guess_entity, "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      ORDER BY date_timestamp) AS total_revenue_cumulative_fiscal_year,
      FROM "{{ ref('YOUR_MODEL_HERE') }}"
      WHERE total_gifts > 0 OR total_revenue > 0
      ORDER BY 2,3,1 ASC
    docs:
      show: true
    arguments:
      - name: date_to_convert
        type: date, datetime, or timestamp
        description: A date you'd like to get the fiscal week out of.
      - name: fiscal_year_start
        type: string
        description: Fiscal year start date in MM-YY format.
  - name: get_fiscal_day
    description: >
      A macro that allows you to get fiscal day from a date, datetime,
      or timestamp with a fiscal year start date. Usage shown below
      SELECT date_timestamp,
        channel,
        best_guess_entity,
        "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_year,
        "{{dbt_arc_functions.get_fiscal_quarter('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_quarter,
        "{{dbt_arc_functions.get_fiscal_month('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_month,
        "{{dbt_arc_functions.get_fiscal_week('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_week,
        "{{dbt_arc_functions.get_fiscal_day('date_timestamp', var('fiscal_year_start'))}}"
      AS fiscal_day,
        total_gifts,
        SUM(total_gifts)OVER(PARTITION BY channel, best_guess_entity, "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      ORDER BY date_timestamp) AS total_gifts_cumulative_fiscal_year,
        total_revenue,
        SUM(total_revenue)OVER(PARTITION BY channel, best_guess_entity, "{{dbt_arc_functions.get_fiscal_year('date_timestamp', var('fiscal_year_start'))}}"
      ORDER BY date_timestamp) AS total_revenue_cumulative_fiscal_year,
      FROM "{{ ref('YOUR_MODEL_HERE') }}"
      WHERE total_gifts > 0 OR total_revenue > 0
      ORDER BY 2,3,1 ASC
    docs:
      show: true
    arguments:
      - name: date_to_convert
        type: date, datetime, or timestamp
        description: A date you'd like to get the fiscal day out of.
      - name: fiscal_year_start
        type: string
        description: Fiscal year start date in MM-YY format.
